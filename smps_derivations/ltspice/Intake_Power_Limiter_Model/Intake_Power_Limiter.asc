Version 4
SHEET 1 2300 1836
WIRE 496 -128 400 -128
WIRE 544 -128 496 -128
WIRE 1152 -128 816 -128
WIRE 1248 -128 1152 -128
WIRE 1152 -16 1152 -128
WIRE 544 0 544 -128
WIRE 816 0 816 -128
WIRE -912 64 -944 64
WIRE 64 64 -912 64
WIRE 400 64 400 -128
WIRE 400 64 320 64
WIRE -944 144 -944 64
WIRE 64 144 -512 144
WIRE 544 144 544 80
WIRE 544 144 320 144
WIRE 816 144 816 80
WIRE 816 144 544 144
WIRE 1152 144 1152 64
WIRE 1152 144 816 144
WIRE 544 176 544 144
WIRE 64 208 -336 208
WIRE 64 240 -272 240
WIRE -512 256 -512 144
WIRE 64 272 -208 272
WIRE 480 272 320 272
WIRE 640 272 480 272
WIRE 64 304 -160 304
WIRE -944 320 -944 224
WIRE 64 336 -128 336
WIRE 448 336 320 336
WIRE 640 368 640 272
WIRE -512 464 -512 336
WIRE 448 512 448 336
WIRE 544 512 448 512
WIRE 640 512 640 448
WIRE 640 512 544 512
WIRE 544 544 544 512
WIRE 784 800 576 800
WIRE 1840 800 1632 800
WIRE -176 848 -256 848
WIRE 784 848 784 800
WIRE 1840 848 1840 800
WIRE 576 864 576 800
WIRE 1632 864 1632 800
WIRE -176 960 -176 848
WIRE 784 992 784 928
WIRE 1168 992 784 992
WIRE 1392 992 1232 992
WIRE 1456 992 1392 992
WIRE 1840 992 1840 928
WIRE 1840 992 1520 992
WIRE -304 1072 -384 1072
WIRE 496 1072 320 1072
WIRE 528 1072 496 1072
WIRE 704 1072 528 1072
WIRE 784 1072 784 992
WIRE 784 1072 704 1072
WIRE 816 1072 784 1072
WIRE 960 1072 880 1072
WIRE 1744 1072 1680 1072
WIRE 1840 1072 1840 992
WIRE 1840 1072 1808 1072
WIRE 1904 1072 1840 1072
WIRE 2048 1072 1904 1072
WIRE 2224 1072 2048 1072
WIRE 2256 1072 2224 1072
WIRE -176 1104 -176 1040
WIRE 320 1120 320 1072
WIRE 2048 1136 2048 1072
WIRE -304 1152 -304 1072
WIRE -384 1168 -384 1072
WIRE 48 1232 -32 1232
WIRE 224 1232 160 1232
WIRE 320 1232 320 1200
WIRE 320 1232 224 1232
WIRE 1392 1248 1392 992
WIRE 1680 1248 1680 1072
WIRE 1904 1248 1904 1072
WIRE 2224 1248 2224 1072
WIRE 704 1264 704 1072
WIRE 960 1264 960 1072
WIRE -32 1296 -32 1232
WIRE 320 1296 320 1232
WIRE 528 1296 528 1072
WIRE 2048 1296 2048 1216
WIRE -1728 1312 -1808 1312
WIRE -1520 1312 -1648 1312
WIRE -1408 1312 -1520 1312
WIRE -1136 1312 -1232 1312
WIRE -384 1312 -384 1248
WIRE -336 1312 -384 1312
WIRE -192 1312 -256 1312
WIRE -176 1312 -176 1184
WIRE -176 1312 -192 1312
WIRE -144 1312 -176 1312
WIRE -128 1312 -144 1312
WIRE -80 1312 -128 1312
WIRE 160 1312 160 1232
WIRE -192 1344 -192 1312
WIRE -80 1360 -112 1360
WIRE -1520 1392 -1520 1312
WIRE -1232 1392 -1232 1312
WIRE -384 1392 -384 1312
WIRE -1808 1408 -1808 1312
WIRE -192 1440 -192 1408
WIRE -192 1440 -256 1440
WIRE -112 1440 -112 1360
WIRE -112 1440 -192 1440
WIRE -32 1456 -32 1376
WIRE 48 1456 48 1232
WIRE 48 1456 -32 1456
WIRE 160 1456 160 1392
WIRE 160 1456 48 1456
WIRE 320 1456 320 1360
WIRE 320 1456 160 1456
WIRE 528 1456 528 1360
WIRE 528 1456 320 1456
WIRE 704 1456 704 1344
WIRE 704 1456 528 1456
WIRE 960 1456 960 1344
WIRE 960 1456 704 1456
WIRE 1392 1456 1392 1328
WIRE 1392 1456 960 1456
WIRE 1680 1456 1680 1328
WIRE 1680 1456 1392 1456
WIRE 1904 1456 1904 1328
WIRE 1904 1456 1680 1456
WIRE 2048 1456 2048 1360
WIRE 2048 1456 1904 1456
WIRE 2224 1456 2224 1312
WIRE 2224 1456 2048 1456
WIRE -384 1472 -384 1392
WIRE 2224 1504 2224 1456
WIRE -144 1520 -144 1312
WIRE -1808 1568 -1808 1488
WIRE -1520 1568 -1520 1472
WIRE -1520 1568 -1808 1568
WIRE -1232 1568 -1232 1472
WIRE -1232 1568 -1520 1568
WIRE -1808 1600 -1808 1568
WIRE -384 1616 -384 1552
WIRE -144 1616 -144 1584
WIRE -144 1616 -384 1616
WIRE -384 1648 -384 1616
FLAG -944 320 0
FLAG 544 544 0
FLAG 1248 -128 Vout
FLAG -912 64 Vin
FLAG 480 272 Ic
FLAG -272 240 icg
FLAG -208 272 idg
FLAG -160 304 ipk
FLAG -128 336 iv
FLAG -336 208 Dc
FLAG -512 464 0
FLAG 496 -128 Vdg
FLAG 544 176 0
FLAG 2224 1504 0
FLAG 496 1072 SFST
FLAG 2256 1072 Vc
FLAG -384 1648 0
FLAG -304 1152 0
FLAG 576 864 0
FLAG 1632 864 0
FLAG -256 1440 Vlim
FLAG -256 848 Vin
FLAG -1808 1600 0
FLAG -1408 1312 Vlim_
FLAG 224 1232 VIPL
FLAG -128 1312 Vcomp
FLAG -384 1392 isense
FLAG -1136 1312 Vlim
DATAFLAG -208 240 ""
DATAFLAG -112 272 ""
DATAFLAG -112 304 ""
DATAFLAG -32 336 ""
DATAFLAG -208 208 ""
SYMBOL voltage -944 128 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -151 263 Left 2
SYMATTR Value PULSE(60 8 3m 20m 5m 5m 30m)
SYMATTR InstName V1
SYMBOL CPM_Control_IRM 192 144 R0
SYMATTR InstName X2
SYMATTR SpiceLine Fsw={Fsw} Lm={Lm} mcmp=300k
SYMATTR SpiceLine2 Dmin=10m Dmax=0.85
SYMBOL res -528 240 R0
SYMATTR InstName R3
SYMATTR Value {Rsense}
SYMBOL bv 544 -16 R0
SYMATTR InstName B1
SYMATTR Value V=V(Vout)*Nps
SYMBOL bi2 816 0 R0
SYMATTR InstName B2
SYMATTR Value I=I(B1)*Nps
SYMBOL voltage 1152 -32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 12
SYMBOL cap 304 1296 R0
WINDOW 39 24 84 Left 2
SYMATTR SpiceLine IC=2.5
SYMATTR InstName C1
SYMATTR Value 100n
SYMBOL cap 512 1296 R0
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL res 304 1104 R0
SYMATTR InstName R1
SYMATTR Value 2k
SYMBOL current 704 1344 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I1
SYMATTR Value {ISFST}
SYMBOL diode 816 1088 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMATTR Value DI
SYMBOL voltage 960 1248 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 3.3
SYMBOL cap 2032 1296 R0
SYMATTR InstName C3
SYMATTR Value 22n
SYMBOL cap 2208 1248 R0
SYMATTR InstName C4
SYMATTR Value 1n
SYMBOL res 2032 1120 R0
SYMATTR InstName R2
SYMATTR Value 22k
SYMBOL current 1904 1328 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName I2
SYMATTR Value {IVC}
SYMBOL bv 1680 1232 M0
SYMATTR InstName B3
SYMATTR Value V=V(SFST)
SYMBOL diode 1808 1056 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D2
SYMATTR Value DI
SYMBOL diode 1456 1008 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D3
SYMATTR Value DI
SYMBOL voltage 1392 1232 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 0.8
SYMBOL bv 640 352 R0
SYMATTR InstName B4
SYMATTR Value V=if(V(Vc)>1.0, (V(Vc)-1)*gVc/rsense, 1u)
SYMBOL g2 -32 1392 M180
WINDOW 3 23 -169 Left 2
SYMATTR Value {Lm/(Vin*Tsw*Rpulldown*Rsense)}
SYMATTR InstName G1
SYMBOL res -400 1456 R0
SYMATTR InstName R4
SYMATTR Value {Rsense}
SYMBOL bi -384 1168 M0
SYMATTR InstName B5
SYMATTR Value I=V(ipk)
SYMBOL res -240 1296 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 400
SYMBOL diode -176 1408 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMATTR Value DI
SYMBOL diode 1232 976 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D5
SYMATTR Value DI
SYMBOL res 768 832 R0
SYMATTR InstName R6
SYMATTR Value 100k
SYMBOL res 1824 832 R0
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL res -192 1088 R0
SYMATTR InstName R9
SYMATTR Value 301k
SYMBOL res -192 944 R0
SYMATTR InstName R10
SYMATTR Value 1Meg
SYMBOL voltage -1808 1392 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vlimit}
SYMBOL cap -160 1520 R0
SYMATTR InstName C5
SYMATTR Value 10p
SYMATTR SpiceLine Rser=10
SYMBOL bi 160 1312 R0
WINDOW 3 -72 174 Left 2
SYMATTR Value I=V(VIPL)*I(G1)
SYMATTR InstName B6
SYMBOL res -1632 1296 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 11.5k
SYMBOL res -1536 1376 R0
SYMATTR InstName R11
SYMATTR Value 301
SYMBOL bv -1232 1376 R0
SYMATTR InstName B7
SYMATTR Value V=V(vlim_)
TEXT -440 424 Left 2 !.tran 0 25m 1m
TEXT 64 544 Left 2 !.param Rsense 6m\n.param gVc 0.07\n.param ilim {75m/Rsense}
TEXT 64 648 Left 2 !.param Vin 24\n.param Lm 35u\n.param Nps 2\n.param Fsw 65k\n.param Tsw {1/Fsw}
TEXT 504 1592 Left 2 !.model DI D(Vfwd=1u Ron=1u)
TEXT -112 1688 Left 2 !.param Rpulldown 499
TEXT -368 1736 Left 2 ;(Ipk - Ilim) = D*Tsw*Vin/Lm\ntover = D*Tsw = (Ipk-Ilim)*Lm/Vin\nD = (Ipk-Ilim)*Lm/(Vin*Tsw)\nIpulldown = D*V(SFST)/Rpulldown
TEXT 512 1696 Left 2 !.param ISFST 26u\n.param IVC 50u
TEXT 0 848 Left 2 !.step param Fsw list 58k 65k 72k
TEXT 0 896 Left 2 !.step param Lm list 33u 35u 37u
TEXT 0 952 Left 2 !.step param Vlimit list 2.37 2.5 2.63
