Version 4
SHEET 1 2048 1860
WIRE 560 -1824 432 -1824
WIRE 432 -1760 432 -1824
WIRE 560 -1760 560 -1824
WIRE 288 -1616 224 -1616
WIRE 432 -1616 432 -1680
WIRE 432 -1616 288 -1616
WIRE 224 -1552 224 -1616
WIRE 432 -1552 432 -1616
WIRE 224 -1424 224 -1472
WIRE 432 -1392 432 -1488
WIRE 224 -1312 224 -1360
WIRE 224 -1184 224 -1232
WIRE 880 -1056 688 -1056
WIRE 688 -992 688 -1056
WIRE 160 -960 112 -960
WIRE 112 -896 112 -960
WIRE 688 -848 688 -912
WIRE 112 -768 112 -816
WIRE 864 -704 672 -704
WIRE 672 -640 672 -704
WIRE 160 -624 112 -624
WIRE 112 -560 112 -624
WIRE 672 -496 672 -560
WIRE 112 -432 112 -480
WIRE 880 -336 688 -336
WIRE 160 -320 112 -320
WIRE 688 -272 688 -336
WIRE 112 -256 112 -320
WIRE 112 -128 112 -176
WIRE 688 -128 688 -192
WIRE 864 16 672 16
WIRE 112 80 64 80
WIRE 176 80 112 80
WIRE 672 80 672 16
WIRE 112 128 112 80
WIRE 672 224 672 160
WIRE 112 256 112 208
FLAG 112 256 0
FLAG 176 80 ipk
FLAG 672 -496 0
FLAG 864 -704 v0_
FLAG 688 -848 0
FLAG 880 -1056 v1_
FLAG 112 -432 0
FLAG 160 -624 Dpulse
FLAG 112 -768 0
FLAG 160 -960 SFST
FLAG 432 -1392 0
FLAG 560 -1760 0
FLAG 224 -1184 0
FLAG 288 -1616 SFST_REAL
FLAG 112 -128 0
FLAG 160 -320 dT_pulse
FLAG 672 224 0
FLAG 864 16 v0
FLAG 688 -128 0
FLAG 880 -336 v1
DATAFLAG 736 -1056 ""
DATAFLAG 64 80 ""
DATAFLAG 112 -624 ""
DATAFLAG 112 -960 ""
DATAFLAG 112 -320 ""
DATAFLAG 736 -336 ""
SYMBOL voltage 112 112 R0
WINDOW 3 24 152 Left 2
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value PULSE({dI*0.99} {dI} {T} 10n 10n 1)
SYMATTR Value2 AC 1
SYMBOL bv 672 -656 R0
SYMATTR InstName B3
SYMATTR Value V=(V(v1_)-Is*R)*exp(-V(ipk)*L/(Vin*tau)) + Is*R + (Is/C)*(T-V(ipk)*L/Vin)
SYMBOL bv 688 -1008 R0
SYMATTR InstName B4
SYMATTR Value V=delay(V(v0_),T)
SYMBOL voltage 112 -576 R0
SYMATTR InstName V2
SYMATTR Value {D}
SYMBOL voltage 112 -912 R0
SYMATTR InstName V3
SYMATTR Value {Vsfst}
SYMBOL cap 416 -1552 R0
SYMATTR InstName C1
SYMATTR Value {C}
SYMBOL current 432 -1760 R0
SYMATTR InstName I1
SYMATTR Value {Is}
SYMBOL res 208 -1568 R0
SYMATTR InstName R1
SYMATTR Value {Rpd}
SYMBOL voltage 224 -1328 R0
WINDOW 3 -449 90 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value PULSE(10 0 0 10p 10p {dT} {T})
SYMBOL voltage 112 -272 R0
SYMATTR InstName V5
SYMATTR Value {dT}
SYMBOL diode 208 -1424 R0
SYMATTR InstName D1
SYMATTR Value DI
SYMBOL bv 672 64 R0
SYMATTR InstName B1
SYMATTR Value V=V(v1) - (V(v1)/R - Is)*V(ipk)*L/(Vin*C)  + (Is/C)*(T-V(ipk)*L/Vin)
SYMBOL bv 688 -288 R0
SYMATTR InstName B2
SYMATTR Value V=delay(V(v0),T)
TEXT -432 -472 Left 2 !.param L = 35u\n.param IP0 = 10.3\n.param C = 100n\n.param Vin = 8\n.param Vout=12\n.param Nps = 2\n.param R = 1k\n.param Fs = 65k\n.param T = {1/Fs}\n.param mcmp = 550k\n.param gVc = 0.07\n.param Rsns = 6m\n.param tau = {R*C}\n.param Is = 20u
TEXT 88 464 Left 2 !.tran 0 100m 0
TEXT -496 552 Left 2 ;V=V(v1) - V(v1)*V(ipk)*L/(tau*Vin) - Is*L*V(ipk)/(C*Vin) + Is*R + Is*T/C
TEXT -400 224 Left 2 ;.ac dec 1k 10 32.5k
TEXT -528 -904 Left 2 !.param Rpd = {R}\n.param Isfst = {Is}\n.param md = {Vout*Nps/L}\n.param mc = {Vin/L}\n.param Dpt = {md/(mc+md)}\n.param Iv = {IP0 - Dpt*mc/Fs}\n.param Ic = {Iv + Dpt*(mc+mcmp)/Fs}\n.param Vsfst = {{1.0 + Ic*Rsns/gVc}}\n.param Ipd = {Vsfst/Rpd - Isfst}\n.param D = {(-Ipd*Rpd  + Vsfst)/Vsfst}\n.param dT = {D/Fs}\n.param dI = {dT*mc}
TEXT 560 -1496 Left 2 !.IC V(SFST_REAL) = {Vsfst*1.011}
TEXT 320 -1192 Left 2 !.model DI D(Vfwd=10n Ron=10n)
