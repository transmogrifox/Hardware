Version 4
SHEET 1 7020 6276
WIRE 224 496 144 496
WIRE 144 560 144 496
WIRE 144 704 144 640
WIRE 224 800 144 800
WIRE 144 864 144 800
WIRE 144 1008 144 944
WIRE 224 1056 144 1056
WIRE 144 1120 144 1056
WIRE -1152 1200 -1232 1200
WIRE -1232 1264 -1232 1200
WIRE 144 1264 144 1200
WIRE -1232 1408 -1232 1344
WIRE -1152 1856 -1232 1856
WIRE -432 1856 -512 1856
WIRE -1232 1920 -1232 1856
WIRE -512 1920 -512 1856
WIRE -1232 2064 -1232 2000
WIRE -512 2064 -512 2000
WIRE 3568 3392 3440 3392
WIRE 3856 3392 3728 3392
WIRE 464 3408 336 3408
WIRE -832 3424 -1008 3424
WIRE 0 3424 -128 3424
WIRE 3568 3504 3568 3392
WIRE 3856 3504 3856 3392
WIRE 464 3520 464 3408
WIRE -832 3536 -832 3424
WIRE 0 3536 0 3424
WIRE 3568 3648 3568 3584
WIRE 3856 3648 3856 3584
WIRE 464 3664 464 3600
WIRE -832 3680 -832 3616
WIRE 0 3680 0 3616
WIRE 2944 3968 2768 3968
WIRE 3248 3968 3104 3968
WIRE -1744 4000 -1920 4000
WIRE -1440 4000 -1584 4000
WIRE 2944 4080 2944 3968
WIRE 3248 4080 3248 3968
WIRE -1744 4112 -1744 4000
WIRE -1440 4112 -1440 4000
WIRE 2944 4224 2944 4160
WIRE 3248 4224 3248 4160
WIRE -1744 4256 -1744 4192
WIRE -1440 4256 -1440 4192
WIRE 3200 4416 2960 4416
WIRE 3888 4416 3696 4416
WIRE 4656 4416 4448 4416
WIRE 5680 4416 5600 4416
WIRE -1488 4448 -1728 4448
WIRE -800 4448 -992 4448
WIRE -32 4448 -240 4448
WIRE 992 4448 912 4448
WIRE 2960 4528 2960 4416
WIRE 3696 4528 3696 4416
WIRE 4448 4528 4448 4416
WIRE 5600 4528 5600 4416
WIRE -1728 4560 -1728 4448
WIRE -992 4560 -992 4448
WIRE -240 4560 -240 4448
WIRE 912 4560 912 4448
WIRE 2960 4672 2960 4608
WIRE 3696 4672 3696 4608
WIRE 4448 4672 4448 4608
WIRE 5600 4672 5600 4608
WIRE -1728 4704 -1728 4640
WIRE -992 4704 -992 4640
WIRE -240 4704 -240 4640
WIRE 912 4704 912 4640
WIRE 976 4944 896 4944
WIRE 896 5056 896 4944
WIRE 5680 5088 5600 5088
WIRE 896 5200 896 5136
WIRE 5600 5200 5600 5088
WIRE 5600 5344 5600 5280
FLAG 3200 4416 icg_irm_ss
FLAG 2960 4672 0
FLAG 3728 3392 Ioo
FLAG 3856 3648 0
FLAG 2768 3968 k0
FLAG 2944 4224 0
FLAG 3104 3968 k1
FLAG 3248 4224 0
FLAG 4656 4416 icg_irm
FLAG 4448 4672 0
FLAG 3888 4416 <icgbasso>
FLAG 3696 4672 0
FLAG 3568 3648 0
FLAG 3440 3392 IooChk
FLAG 5600 4672 0
FLAG 5680 4416 icg_izoh
FLAG -1488 4448 idg_irm_ss
FLAG -1728 4704 0
FLAG -1008 3424 Ioodg
FLAG -832 3680 0
FLAG -1920 4000 kdg0
FLAG -1744 4256 0
FLAG -1584 4000 kdg1
FLAG -1440 4256 0
FLAG -32 4448 idg_irm
FLAG -240 4704 0
FLAG -800 4448 <idgbasso>
FLAG -992 4704 0
FLAG 912 4704 0
FLAG 992 4448 idg_izoh
FLAG -1232 1408 0
FLAG -1152 1200 icn
FLAG -1232 2064 0
FLAG -1152 1856 iv0
FLAG 144 1008 0
FLAG 224 800 mcmp_v
FLAG -512 2064 0
FLAG -432 1856 iv1
FLAG 144 1264 0
FLAG 224 1056 alpha_v
FLAG 5600 5344 0
FLAG 5680 5088 icg_rcf
FLAG 896 5200 0
FLAG 976 4944 idg_rcf
FLAG 144 704 0
FLAG 224 496 mcmp
FLAG -128 3424 Ioodgck
FLAG 0 3680 0
FLAG 336 3408 Ioodgck2
FLAG 464 3664 0
DATAFLAG 3792 3392 ""
DATAFLAG 3504 3392 ""
DATAFLAG 2832 3968 ""
DATAFLAG 3200 3968 ""
DATAFLAG 3008 4416 ""
DATAFLAG 3760 4416 ""
DATAFLAG 4448 4416 ""
DATAFLAG -896 3424 ""
DATAFLAG -1856 4000 ""
DATAFLAG -1488 4000 ""
DATAFLAG -1680 4448 ""
DATAFLAG -928 4448 ""
DATAFLAG -240 4448 ""
DATAFLAG 160 800 ""
DATAFLAG 192 1056 ""
DATAFLAG 160 496 ""
DATAFLAG -64 3424 ""
DATAFLAG -1216 1856 ""
DATAFLAG -496 1856 ""
DATAFLAG -1200 1200 ""
DATAFLAG 400 3408 ""
SYMBOL bv 2960 4512 R0
SYMATTR InstName B1
SYMATTR Value V=V(k0)*V(iv0) + V(k1)*V(iv1) + fcg
SYMBOL bv 3856 3488 R0
SYMATTR InstName B2
SYMATTR Value V=(acg+bcg+ccg)*V(iv0)*V(iv0) + (dcg+ecg)*V(iv0) + fcg
SYMBOL bv 2944 4064 R0
WINDOW 3 -127 197 Left 2
SYMATTR Value V=2*acg*iv + ccg*iv +dcg
SYMATTR InstName B3
SYMBOL bv 3248 4064 R0
WINDOW 3 -69 198 Left 2
SYMATTR Value V=2*bcg*iv +ccg*iv + ecg
SYMATTR InstName B4
SYMBOL bv 4448 4512 R0
SYMATTR InstName B6
SYMATTR Value V=acg*V(iv0)*V(iv0) + bcg*V(iv1)*V(iv1) + ccg*V(iv0)*V(iv1) + dcg*V(iv0) + ecg*V(iv1) + fcg
SYMBOL bv 3696 4512 R0
SYMATTR InstName B7
SYMATTR Value V=V(Ioo) Laplace=(1 + s/wrhpz)
SYMBOL bv 3568 3488 R0
SYMATTR InstName B10
SYMATTR Value V=Iinf
SYMBOL bv 5600 4512 R0
SYMATTR InstName B13
SYMATTR Value V=V(icg_irm_ss) Laplace=s*Tsw/(1 - exp(-s*Tsw))
SYMBOL bv -1728 4544 R0
SYMATTR InstName B8
SYMATTR Value V=V(kdg0)*V(iv0) + V(kdg1)*V(iv1) + fdg
SYMBOL bv -832 3520 R0
SYMATTR InstName B9
SYMATTR Value V=(adg+bdg+cdg)*V(iv0)*V(iv0) + (ddg+edg)*V(iv0) + fdg
SYMBOL bv -1744 4096 R0
WINDOW 3 -127 197 Left 2
SYMATTR Value V=2*adg*iv + cdg*iv +ddg
SYMATTR InstName B11
SYMBOL bv -1440 4096 R0
WINDOW 3 -69 198 Left 2
SYMATTR Value V=2*bdg*iv +cdg*iv + edg
SYMATTR InstName B12
SYMBOL bv -240 4544 R0
SYMATTR InstName B15
SYMATTR Value V=adg*V(iv0)*V(iv0) + bdg*V(iv1)*V(iv1) + cdg*V(iv0)*V(iv1) + ddg*V(iv0) + edg*V(iv1) + fdg
SYMBOL bv -992 4544 R0
SYMATTR InstName B16
SYMATTR Value V=V(Ioodg) Laplace=(1 - s/wrhpzdg)
SYMBOL bv 912 4544 R0
SYMATTR InstName B18
SYMATTR Value V=V(idg_irm_ss) Laplace=s*Tsw/(1 - exp(-s*Tsw))
SYMBOL voltage -1232 1248 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V2
SYMATTR Value {ic}
SYMBOL bv -1232 1904 R0
SYMATTR InstName B14
SYMATTR Value V=alpha*V(icn) + (1-alpha)*V(iv1) - Tsw*md
SYMBOL bv -512 1904 R0
SYMATTR InstName B17
SYMATTR Value V=delay(V(iv0), Tsw)
SYMBOL bv 144 848 R0
SYMATTR InstName B19
SYMATTR Value V={mcmp*V(icn)}
SYMBOL bv 144 1104 R0
SYMATTR InstName B20
SYMATTR Value V={alpha*V(icn)}
SYMBOL bv 5600 5184 R0
SYMATTR InstName B5
SYMATTR Value V=V(icg_izoh)*gcg_rcf Laplace=(Iv)*(1 - exp(-s*Dc*Tsw))/(s) + (mc)*(1 - (1 + s*Dc*Tsw)*exp(-s*Dc*Tsw))/(s*s)
SYMBOL bv 896 5040 R0
SYMATTR InstName B21
SYMATTR Value V=V(idg_izoh)*gdg_rcf Laplace=( ((Iv+md*Dpdg*Tsw))*(1 - exp(-s*Dpdg*Tsw))/(s) - md*(1 - (1 + s*Dpdg*Tsw)*exp(-s*Dpdg*Tsw))/(s*s) )*exp(-s*Dc*Tsw)
SYMBOL bv 144 544 R0
SYMATTR InstName B22
SYMATTR Value V={mcmp}
SYMBOL bv 0 3520 R0
SYMATTR InstName B23
SYMATTR Value V=Iinfdg
SYMBOL bv 464 3504 R0
SYMATTR InstName B24
SYMATTR Value V=Fsw/gdg_rcf
TEXT 2944 4760 Left 3 ;AVERAGE OUTPUT CURRENT: \nSMALL SIGNAL MODEL
TEXT -1216 -704 Left 2 !.param Vin 18\n.param Vout 5.25\n.param N 4\n.param Vcg {Vin}\n.param Vdg {N*Vout}\n.param iv 10\n.param Lm 23u\n.param Fsw 100k\n.param Tsw {1/Fsw}
TEXT -1216 -272 Left 2 !.param mc {Vcg/Lm}\n.param md {Vdg/Lm}\n.param dencom {(mc*mc + 2*mc*md + md*md)}\n.param acg {(1/(2*Tsw))*((mc)/dencom)}\n.param bcg {-(1/(2*Tsw))*((mc + 2*md)/dencom)}\n.param ccg {(1/(Tsw))*((md)/dencom)}\n.param dcg {(mc*md)/dencom}\n.param ecg {md*md/dencom}\n.param fcg  {(Tsw/2)*mc*md*md/dencom}
TEXT 4424 4760 Left 3 ;AVERAGE OUTPUT CURRENT: \nEXACT NONLINEAR EXPRESSION
TEXT 3680 4760 Left 3 ;AVERAGE OUTPUT CURRENT: \nCONVENTIONAL SMALL SIGNAL MODEL\n(e.g. CHRISTOPH BASSO)
TEXT 3664 4168 Left 2 !.param Dc {Vdg/(Vdg+Vcg)}\n.param Dp {1-Dc}\n.param wrhpz ro*Dc*Dc/(Dp*Lm)
TEXT 3664 4104 Left 2 !.param Iinf {(acg+bcg+ccg)*iv*iv + (dcg+ecg)*iv + fcg}\n.param ro {Vcg/Iinf}
TEXT -920 -704 Left 2 ;INPUT BUS VOLTAGE\nCONVERTER OUTPUT VOLTAGE\nCOUPLED INDUCTOR/TRANSFORMER TURNS RATIO (SECONDARY:PRIMARY)\nINDUCTOR CHARGING VOLTAGE\nINDUCTOR DISCHARGING VOLTAGE AS REFLECTED BACK TO PRIMARY SIDE\nSTEADY-STATE VALLEY CURRRENT\nMAGNETIZING INDUCTANCE\nSWITCHING FREQUENCY\nSWITCHING PERIOD
TEXT -1216 -416 Left 2 ;INPUT PARAMETERS -- SYSTEM STEADY-STATE OPERATING CONDITIONS
TEXT -544 -280 Left 2 ;INDUCTOR CURRENT CHARGING SLOPE\nINDUCTOR CURRENT DISCHARGING SLOPE\nCONVENIENT VARIABLE SUBSTITUTION FOR A DENOMINATOR TERM FOUND IN EVERY COEFFICIENT\nCOEFFICIENT: acg*iv[n]^2\nCOEFFICIENT: bcg*iv[n-1]^2\nCOEFFICIENT: ccg*iv[n]*iv[n-1]\nCOEFFICIENT: dcg*iv[n]\nCOEFFICIENT: ecg*iv[n-1]\nCONSTANT   :  fcg, APPEARS IN STEADY-STATE AVERAGE CURRENT COMPUTATION
TEXT -1216 32 Left 2 ;COMPUTED PARAMETERS -- SYSTEM VARIABLES AND COEFFICIENTS
TEXT 3408 3712 Left 2 ;AVERAGED CURRENT STEADY STATE OUTPUT
TEXT 3392 4992 Left 2 ;SMALL SIGNAL MODELS COMPARED WITH EXACT NONLINEAR EXPRESSION
TEXT 2944 4312 Left 2 ;FIR FILTER COEFFICIENTS FOR\nLTI SMALL-SIGNAL MODEL
TEXT 3672 4288 Left 2 ;SYSTEM PARAMS RE-FACTORED\nINTO COMPATIBLE QUANTITIES\nUSED IN C. BASSO RHPZ EQN.
TEXT -1232 -848 Left 3 ;VERIFICATION OF DISCRETE TIME SMALL SIGNAL ANALYTICAL MODEL FOR SWITCH-MODE INDUCTOR:
TEXT -1224 -808 Left 2 ;TRANSFER FUNCTION OF VALLEY CURRENT TO AVERAGE OUTPUT CURRENT EXPRESSED AS FIR FILTER
TEXT -1224 -784 Left 2 ;COMPARED TO CHRISTOPHE BASSO'S CONTINUOUS-TIME APPROXIMATION OF THE RIGHT-HALF PLANE ZERO
TEXT 2496 4440 Left 2 ;DC term "fcg" maintained throughout\nthe discrete model term to see \nDC agreement with conventional \nRHPZ expression
TEXT 5584 4728 Left 2 ;INVERSE ZERO-ORDER-HOLD FUNCTION
TEXT -1744 4792 Left 3 ;AVERAGE OUTPUT CURRENT: \nSMALL SIGNAL MODEL
TEXT -1280 2880 Left 2 !;.param mc {Vcg/Lm}\n;.param md {Vdg/Lm}\n;.param dencom {(mc*mc + 2*mc*md + md*md)}\n.param adg {-(1/(2*Tsw))*((2*mc + md)/dencom)}\n.param bdg {(1/(2*Tsw))*((md)/dencom)}\n.param cdg {(1/(Tsw))*((mc)/dencom)}\n.param ddg {(mc*mc)/dencom}\n.param edg {mc*md/dencom}\n.param fdg  {(Tsw/2)*md*mc*mc/dencom}
TEXT -264 4792 Left 3 ;AVERAGE OUTPUT CURRENT: \nEXACT NONLINEAR EXPRESSION
TEXT -1008 4792 Left 3 ;AVERAGE OUTPUT CURRENT: \nCONVENTIONAL SMALL SIGNAL MODEL\n(e.g. CHRISTOPH BASSO)
TEXT -1024 4200 Left 2 !.param Dcdg {Vdg/(Vdg+Vcg)}\n.param Dpdg {1-Dcdg}\n.param wrhpzdg rodg*Dpdg*Dpdg/(Dcdg*Lm)
TEXT -1024 4136 Left 2 !.param Iinfdg {(adg+bdg+cdg)*iv*iv + (ddg+edg)*iv + fdg}\n.param rodg {Vdg/Iinfdg}
TEXT -608 2872 Left 2 ;INDUCTOR CURRENT CHARGING SLOPE\nINDUCTOR CURRENT DISCHARGING SLOPE\nCONVENIENT VARIABLE SUBSTITUTION FOR A DENOMINATOR TERM FOUND IN EVERY COEFFICIENT\nCOEFFICIENT: adg*iv[n]^2\nCOEFFICIENT: bdg*iv[n-1]^2\nCOEFFICIENT: cdg*iv[n]*iv[n-1]\nCOEFFICIENT: ddg*iv[n]\nCOEFFICIENT: edg*iv[n-1]\nCONSTANT   :  fdg, APPEARS IN STEADY-STATE AVERAGE CURRENT COMPUTATION
TEXT -1280 3184 Left 2 ;COMPUTED PARAMETERS -- SYSTEM VARIABLES AND COEFFICIENTS
TEXT -1280 3744 Left 2 ;AVERAGED CURRENT STEADY STATE OUTPUT
TEXT -1296 5024 Left 2 ;SMALL SIGNAL MODELS COMPARED WITH EXACT NONLINEAR EXPRESSION
TEXT -1744 4344 Left 2 ;FIR FILTER COEFFICIENTS FOR\nLTI SMALL-SIGNAL MODEL
TEXT -1016 4320 Left 2 ;SYSTEM PARAMS RE-FACTORED\nINTO COMPATIBLE QUANTITIES\nUSED IN C. BASSO RHPZ EQN.
TEXT -1312 2704 Left 3 ;VERIFICATION OF DISCRETE TIME SMALL SIGNAL ANALYTICAL MODEL FOR SWITCH-MODE INDUCTOR:
TEXT -1304 2744 Left 2 ;TRANSFER FUNCTION OF VALLEY CURRENT TO AVERAGE OUTPUT CURRENT EXPRESSED AS FIR FILTER
TEXT -1304 2768 Left 2 ;COMPARED TO CHRISTOPHE BASSO'S CONTINUOUS-TIME APPROXIMATION OF THE RIGHT-HALF PLANE ZERO
TEXT -2192 4472 Left 2 ;DC term "fcg" maintained throughout\nthe discrete model term to see \nDC agreement with conventional \nRHPZ expression
TEXT 896 4760 Left 2 ;INVERSE ZERO-ORDER-HOLD FUNCTION
TEXT -1256 1576 Left 2 !.ac oct 500 100 {5*Fsw}
TEXT -1248 1088 Left 2 ;COMPUTED PARAMETERS -- SYSTEM VARIABLES AND COEFFICIENTS
TEXT -1152 1224 Left 2 ;ic[n]
TEXT -1152 1880 Left 2 ;iv[n]
TEXT -1264 1616 Left 2 ;SYSTEM INPUT SOURCES
TEXT -1256 1480 Left 2 ;STIMULUS GENERATION FOR VALLEY CURRENTS
TEXT -1248 920 Left 2 !.param hvdb 3
TEXT -1248 952 Left 2 !.param hvmag {10**(hvdb/20)}\n.param mcmp {(mc+md)*(1+hvmag)/(2*hvmag)-mc}
TEXT -608 920 Left 2 ;PEAK CURRENT CONTROLLER PEAKING (dB)\nPEAK CURRENT CONTROLLER PEAKING - LINEAR\nCONTROLLER SLOPE COMPENSATION
TEXT 272 840 Left 2 ;Place to probe for computed \nslope compensation (A/S)
TEXT -1280 2200 Left 4 ;IIR FILTER FOR TRANSFER FUNCTION
TEXT -1280 2240 Left 2 ;RELATES VALLEY CURRENTS TO PEAK CURRENT COMPARATOR THRESHOLD
TEXT -432 1880 Left 2 ;iv[n-1]
TEXT -1248 1024 Left 2 !.param alpha {(mc+md)/(mc+mcmp)}
TEXT 272 1096 Left 2 ;Place to probe for computed \nslope compensation (A/S)
TEXT -608 1024 Left 2 ;IIR FILTER COEFFICIENT
TEXT -1240 856 Left 2 !.param ic {iv+Tsw*md/alpha}
TEXT 5584 5400 Left 2 ;RECONSTRUCTION FILTER
TEXT 880 5256 Left 2 ;RECONSTRUCTION FILTER
TEXT 1024 5048 Left 2 !.param gdg_rcf {1/(Dpdg*Tsw*Iv+0.5*md*Dpdg*Tsw*Dpdg*Tsw)}
TEXT 5800 5184 Left 2 !.param gcg_rcf {1/(Dc*Tsw*Iv+0.5*mc*Dc*Tsw*Dc*Tsw)}
TEXT 272 536 Left 2 ;Place to probe for computed \nslope compensation (A/S)
LINE Normal -368 -400 -1216 -400 2
LINE Normal -368 48 -1216 48 2
LINE Normal 4256 3728 3408 3728 2
LINE Normal 4240 5008 3392 5008 2
LINE Normal 304 -832 -1232 -832 2
LINE Normal -432 3200 -1280 3200 2
LINE Normal -432 3760 -1280 3760 2
LINE Normal -448 5040 -1296 5040 2
LINE Normal 224 2720 -1312 2720 2
LINE Normal -400 1104 -1248 1104 2
LINE Normal -416 1632 -1264 1632 2
LINE Normal -304 2224 -1280 2224 2
