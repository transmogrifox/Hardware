Version 4
SHEET 1 4228 4212
WIRE 304 224 144 224
WIRE 448 224 304 224
WIRE 624 224 448 224
WIRE 640 224 624 224
WIRE -3120 352 -3200 352
WIRE 144 352 144 224
WIRE 448 352 448 224
WIRE 640 352 640 224
WIRE 304 368 304 224
WIRE -3200 416 -3200 352
WIRE 144 544 144 432
WIRE 304 544 304 432
WIRE 304 544 144 544
WIRE 448 544 448 432
WIRE 448 544 304 544
WIRE 640 544 640 432
WIRE 640 544 448 544
WIRE -3200 560 -3200 496
WIRE 144 592 144 544
WIRE -960 848 -1056 848
WIRE -848 848 -960 848
WIRE 2800 864 2736 864
WIRE 2896 864 2800 864
WIRE 3008 864 2896 864
WIRE 432 880 128 880
WIRE 608 880 432 880
WIRE 624 880 608 880
WIRE 1312 880 1120 880
WIRE 1424 880 1312 880
WIRE 1664 880 1424 880
WIRE 2208 880 2144 880
WIRE 2304 880 2208 880
WIRE 2416 880 2304 880
WIRE -1056 912 -1056 848
WIRE -848 912 -848 848
WIRE 2736 992 2736 864
WIRE 3008 992 3008 864
WIRE -3120 1008 -3200 1008
WIRE -2400 1008 -2480 1008
WIRE 128 1008 128 880
WIRE 432 1008 432 880
WIRE 624 1008 624 880
WIRE 1120 1008 1120 880
WIRE 1424 1008 1424 880
WIRE 1664 1008 1664 880
WIRE 2144 1008 2144 880
WIRE 2416 1008 2416 880
WIRE 2896 1008 2896 864
WIRE 2304 1024 2304 880
WIRE -3200 1072 -3200 1008
WIRE -2480 1072 -2480 1008
WIRE -1056 1136 -1056 992
WIRE -848 1136 -848 992
WIRE -848 1136 -1056 1136
WIRE -1056 1168 -1056 1136
WIRE 2736 1184 2736 1072
WIRE 2896 1184 2896 1072
WIRE 2896 1184 2736 1184
WIRE 3008 1184 3008 1072
WIRE 3008 1184 2896 1184
WIRE 128 1200 128 1088
WIRE 432 1200 432 1088
WIRE 432 1200 128 1200
WIRE 624 1200 624 1088
WIRE 624 1200 432 1200
WIRE 1120 1200 1120 1088
WIRE 1424 1200 1424 1088
WIRE 1424 1200 1120 1200
WIRE 1664 1200 1664 1088
WIRE 1664 1200 1424 1200
WIRE 2144 1200 2144 1088
WIRE 2304 1200 2304 1088
WIRE 2304 1200 2144 1200
WIRE 2416 1200 2416 1088
WIRE 2416 1200 2304 1200
WIRE -3200 1216 -3200 1152
WIRE -2480 1216 -2480 1152
WIRE 2736 1232 2736 1184
WIRE 128 1248 128 1200
WIRE 1120 1248 1120 1200
WIRE 2144 1248 2144 1200
WIRE 176 1408 112 1408
WIRE 416 1408 176 1408
WIRE 1296 1408 1136 1408
WIRE 1328 1408 1296 1408
WIRE 1440 1408 1328 1408
WIRE 112 1536 112 1408
WIRE 416 1536 416 1408
WIRE 1136 1536 1136 1408
WIRE 1440 1536 1440 1408
WIRE 1296 1552 1296 1408
WIRE 112 1728 112 1616
WIRE 416 1728 416 1616
WIRE 416 1728 112 1728
WIRE 1136 1728 1136 1616
WIRE 1296 1728 1296 1616
WIRE 1296 1728 1136 1728
WIRE 1440 1728 1440 1616
WIRE 1440 1728 1296 1728
WIRE -2944 1760 -3168 1760
WIRE -2640 1760 -2864 1760
WIRE -2480 1760 -2640 1760
WIRE -2432 1760 -2480 1760
WIRE -2032 1776 -2080 1776
WIRE 112 1776 112 1728
WIRE 1136 1776 1136 1728
WIRE -2640 1808 -2640 1760
WIRE -2480 1808 -2480 1760
WIRE -3168 1824 -3168 1760
WIRE -2080 1840 -2080 1776
WIRE -2640 1920 -2640 1872
WIRE -3168 1968 -3168 1904
WIRE -2080 1984 -2080 1920
WIRE -2480 2016 -2480 1872
WIRE -2640 2080 -2640 2000
WIRE -2480 2208 -2480 2096
FLAG 144 592 0
FLAG 624 224 vzoh
FLAG 128 1248 0
FLAG 608 880 zoh2
FLAG 1120 1248 0
FLAG 1312 880 r0
FLAG 1136 1776 0
FLAG 1328 1408 out
FLAG 112 1776 0
FLAG 176 1408 ddt
FLAG 2144 1248 0
FLAG 2208 880 r1
FLAG 2736 1232 0
FLAG 2800 864 ramp
FLAG -3200 560 0
FLAG -3120 352 icn
FLAG -3200 1216 0
FLAG -3120 1008 iv0
FLAG -2480 1216 0
FLAG -2400 1008 iv1
FLAG -1056 1168 0
FLAG -960 848 vpulse
FLAG -3168 1968 0
FLAG -2432 1760 DUTY
FLAG -2640 2080 0
FLAG -2480 2208 0
FLAG -2080 1984 0
FLAG -2032 1776 DP
DATAFLAG 176 224 ""
DATAFLAG 2336 880 ""
DATAFLAG 2960 864 ""
DATAFLAG -2608 1760 ""
DATAFLAG -3200 1008 ""
DATAFLAG -3184 352 ""
DATAFLAG 1424 1408 ""
DATAFLAG -2480 1008 ""
SYMBOL bi 144 432 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B1
SYMATTR Value I=V(vpulse)+md*V(DP)*Tsw
SYMBOL bi 640 352 R0
SYMATTR InstName B2
SYMATTR Value I=delay(V(vpulse),V(DP)*tsw)
SYMBOL cap 288 368 R0
SYMATTR InstName C1
SYMATTR Value 1
SYMBOL bi 128 1088 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B3
SYMATTR Value I=V(vpulse)
SYMBOL res 416 992 R0
SYMATTR InstName R2
SYMATTR Value 1
SYMBOL bi 624 1088 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B4
SYMATTR Value I=V(ddt)
SYMBOL bi 1120 1088 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B5
SYMATTR Value I=V(vpulse)
SYMBOL res 1408 992 R0
SYMATTR InstName R3
SYMATTR Value 1
SYMBOL bi 1664 1008 R0
WINDOW 3 24 -39 Left 2
SYMATTR InstName B6
SYMATTR Value I=delay(V(zoh2),V(DP)*tsw)
SYMBOL bi 1136 1616 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B7
SYMATTR Value I=delay(V(vzoh) + v(ramp), V(DUTY)*Tsw)
SYMBOL res 1424 1520 R0
SYMATTR InstName R4
SYMATTR Value {fsw}
SYMBOL bi 2144 1088 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B9
SYMATTR Value I=V(r0)
SYMBOL cap 2288 1024 R0
SYMATTR InstName Cddt1
SYMATTR Value 1
SYMBOL bi 2736 1072 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B10
SYMATTR Value I=-md*V(r1)
SYMBOL cap 2880 1008 R0
SYMATTR InstName Cddt2
SYMATTR Value 1
SYMBOL voltage -3200 400 R0
WINDOW 123 24 124 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V2
SYMATTR Value 8
SYMBOL bv -3200 1056 R0
SYMATTR InstName B11
SYMATTR Value V=alpha*V(icn) + (1-alpha)*V(iv1)-Tsw*md
SYMBOL bv -2480 1056 R0
SYMATTR InstName B12
SYMATTR Value V=delay(V(iv0),Tsw)
SYMBOL bi -1056 992 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B13
SYMATTR Value I=V(iv0)
SYMBOL res -864 896 R0
SYMATTR InstName R5
SYMATTR Value 1
SYMBOL bv -3168 1808 R0
SYMATTR InstName B14
SYMATTR Value V=(V(icn) - V(iv1))*fsw/(mc+mcmp)
SYMBOL res -2848 1744 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL diode -2496 1808 R0
SYMATTR InstName D1
SYMATTR Value DI
SYMBOL diode -2624 1872 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value DI
SYMBOL voltage -2480 2000 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 0.95
SYMBOL voltage -2640 1904 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 0.2
SYMBOL bi 112 1616 R180
WINDOW 0 24 80 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName B15
SYMATTR Value I=V(DP)*Tsw*V(vpulse)
SYMBOL ind 400 1520 R0
SYMATTR InstName L1
SYMATTR Value 1
SYMBOL res 2400 992 R0
SYMATTR InstName R1
SYMATTR Value 100Meg
SYMBOL res 2992 976 R0
SYMATTR InstName R6
SYMATTR Value 100Meg
SYMBOL res 432 336 R0
SYMATTR InstName R7
SYMATTR Value 100Meg
SYMBOL bv -2080 1824 R0
SYMATTR InstName B8
SYMATTR Value V=1-V(DUTY)
TEXT -1208 -720 Left 2 !.param Vin 24\n.param Vout 5.25\n.param Vcg {Vin}\n.param Vdg {4*Vout}\n.param ic 12\n.param Lm 23u\n.param Fsw 100k\n.param Tsw {1/Fsw}
TEXT -1216 -272 Left 2 !.param mc {Vcg/Lm}\n.param md {Vdg/Lm}
TEXT -912 -720 Left 2 ;INPUT BUS VOLTAGE\nCONVERTER OUTPUT VOLTAGE\nCHARGING CYCLE VOLTAGE\nDISCHARGING CYCLE VOLTAGE\nSTEADY-STATE PEAK CURRENT CONTROL LEVEL\nMAGNETIZING INDUCTANCE\nSWITCHING FREQUENCY\nSWITCHING PERIOD
TEXT -1216 -416 Left 2 ;INPUT PARAMETERS -- SYSTEM STEADY-STATE OPERATING CONDITIONS
TEXT -576 -272 Left 2 ;INDUCTOR CURRENT CHARGING SLOPE (A/S)\nINDUCTOR CURRENT DISCHARGING SLOPE (A/S)
TEXT -1216 0 Left 2 ;COMPUTED PARAMETERS -- SYSTEM VARIABLES AND COEFFICIENTS
TEXT -1232 -848 Left 3 ;VERIFICATION OF DISCRETE TIME SMALL SIGNAL ANALYTICAL MODEL FOR SWITCH-MODE INDUCTOR:
TEXT -1224 -808 Left 2 ;TRANSFER FUNCTION OF VALLEY CURRENT TO AVERAGE OUTPUT CURRENT EXPRESSED AS FIR FILTER
TEXT -1224 -784 Left 2 ;COMPARED TO CHRISTOPHE BASSO'S CONTINUOUS-TIME APPROXIMATION OF THE RIGHT-HALF PLANE ZERO
TEXT -1216 -168 Left 2 !.param hvdb 0
TEXT -1216 -136 Left 2 !.param hvmag {10**(hvdb/20)}\n.param mcmp {(mc+md)*(1+hvmag)/(2*hvmag)-mc}
TEXT -576 -168 Left 2 ;PEAK CURRENT CONTROLLER PEAKING (dB)\nPEAK CURRENT CONTROLLER PEAKING - LINEAR\nCONTROLLER SLOPE COMPENSATION
TEXT -1216 -64 Left 2 !.param alpha {(mc+md)/(mc+mcmp)}
TEXT -576 -64 Left 2 ;IIR FILTER COEFFICIENT
TEXT 216 600 Left 2 !;tran 0 1m 0 1n startup
TEXT -1208 -208 Left 2 !.param D {md/(mc+md)}
TEXT -3224 728 Left 2 ;.ac oct 500 100 {Fsw}
TEXT -3120 376 Left 2 ;ic[n]
TEXT -3120 1032 Left 2 ;iv[n]
TEXT -3232 768 Left 2 ;SYSTEM INPUT SOURCES
TEXT -3224 632 Left 2 ;STIMULUS GENERATION FOR VALLEY CURRENTS
TEXT -3248 1352 Left 4 ;IIR FILTER FOR TRANSFER FUNCTION
TEXT -3248 1392 Left 2 ;RELATES VALLEY CURRENTS TO PEAK CURRENT COMPARATOR THRESHOLD
TEXT -2400 1032 Left 2 ;iv[n-1]
TEXT -2880 2320 Left 2 !.model DI D(vfwd=1u ron=1u)
TEXT -3328 2312 Left 2 !.ac oct 100 10 {10*fsw}
LINE Normal -368 -400 -1216 -400 2
LINE Normal -368 16 -1216 16 2
LINE Normal 304 -832 -1232 -832 2
LINE Normal -2384 784 -3232 784 2
LINE Normal -2272 1376 -3248 1376 2
